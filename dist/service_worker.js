const NETWORKS={base:{name:"Base",domain:"api.basescan.org",usdcContractAddress:"0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913",color:[0,79,247,255],src:"images/baseIcon.png"},ethereum:{name:"Ethereum",domain:"api.etherscan.io",usdcContractAddress:"0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48",color:[95,88,131,255],src:"images/ethereumIcon.png"},"arbitrum-one":{name:"Arbitrum",domain:"api.arbiscan.io",usdcContractAddress:"0xaf88d065e77c8cc2239327c5edb3a432268e5831",color:[17,165,247,255],src:"images/arbitrumIcon.png"},"optimistic-ethereum":{name:"Optimism",domain:"api-optimistic.etherscan.io",usdcContractAddress:"0x0b2c639c533813f4aa9d7837caf62653d097ff85",color:[247,4,31,255],src:"images/optimismIcon.png"},scroll:{name:"Scroll",domain:"api.scrollscan.com",usdcContractAddress:"0x06eFdBFf2a14a7c8E15944D1F4A48F9F95F663A4",color:[255,238,218,255],src:"images/scrollIcon.png"},zksync:{name:"zkSync",domain:"api-era.zksync.network",usdcContractAddress:"0x3355df6d4c9c3035724fd0e3914de96a5a83aaf4",color:[46,49,139,255],src:"images/zksyncIcon.png"}};(async()=>{async function e(){try{let{networkPref:e}=await chrome.storage.local.get("networkPref");e||(e="base",console.log("Network preference not found"));const o=NETWORKS[e],r=await fetch(`https://${o.domain}/api?module=account&action=tokentx&contractaddress=${o.usdcContractAddress}&page=1&offset=30&startblock=0&endblock=99999999&sort=desc`);if(!r.ok)throw new Error(`Fetch error, token txs, domain: ${o.domain}, contract${o.usdcContractAddress}, info: ${r.status} ${r.statusText}`);const t=await r.json();let c=0,a=0;t?.result?.length>0&&t?.result?.forEach((e=>{console.log(e.gasPrice),c+=parseInt(e.gasPrice),a++}));let s=c/a,n=Math.floor(parseInt(s)/1e6);if(!n)throw new Error("Gas price not found");if(console.log("averageGasPriceInMwei: ",n),n>9999)n=`${Math.round(n/1e3)}k`;else if(n>999){let e=(n/1e3).toFixed(1);n=e.length>3?`${Math.round(n/1e3)}k`:`${e}k`}chrome.action.setBadgeText({text:`${n}`}),chrome.action.setBadgeBackgroundColor({color:o.color})}catch(e){console.error("Error fetching base txs: ",e?.message)}}chrome.runtime.onInstalled.addListener((()=>{chrome.alarms.create("fetchLatestGasPrices",{delayInMinutes:0,periodInMinutes:10}),e()})),chrome.runtime.onStartup.addListener((()=>{e()})),chrome.alarms.onAlarm.addListener((o=>{"fetchLatestGasPrices"===o.name&&e()})),chrome.runtime.onMessage.addListener(((o,r,t)=>{if("setIcon"===o.action){const{networkPref:r}=o,t=NETWORKS[r];t&&t.src?chrome.action.setIcon({path:t.src}):console.error("Network not found or icon path not defined for:",r),chrome.action.setBadgeText({text:"..."}),chrome.action.setBadgeBackgroundColor({color:t.color}),e()}}))})();